---
title: "TME-Pisaura"
output: html_document
editor_options:
  chunk_output_type: console
---


## Packages

```{r packages}
require(ggplot2)
require(ggpubr)
require(tidyverse)
require(data.table)
require(rstatix)
require(ggpubr)
require(lme4)
require(lmerTest)
```

## Harvest data

```{r data-harvest}
#read table
TME = fread("TME_Pisaura_data.csv", header = TRUE, encoding = 'Latin-1', stringsAsFactors = FALSE)
Etho1 = fread('Pisaura Ethovision 1.csv', header =TRUE, encoding = 'Latin-1', stringsAsFactors = FALSE)
Etho2 = fread('Pisaura Ethovision 2.csv', header =TRUE, encoding = 'Latin-1', stringsAsFactors = FALSE)
Etho3 = fread('Pisaura Ethovision 3.csv', header =TRUE, encoding = 'Latin-1', stringsAsFactors = FALSE)
Etho4 = fread('Pisaura Ethovision 4.csv', header =TRUE, encoding = 'Latin-1', stringsAsFactors = FALSE)
```

## Prepare data

```{r data-preparation}
TMEnoNA = na.omit(TME)
names(TME)[names(TME) == "t_on_start side"] <- "t_on_start_side"
names(TMEnoNA)[names(TMEnoNA) == "t_on_start side"] <- "t_on_start_side"
gsub('c', 'C', TME$side_start)
gsub('c', 'C', TMEnoNA$side_start)

TMEnoNA = TMEnoNA %>%
  convert_as_factor(family, id, Camera, round, side_start, side_opp., day_test)

Etho4 <- select(Etho4, -'seconds blank',-'seconds cue')
names(Etho1) <- names(Etho4)
names(Etho2) <- names(Etho4)
names(Etho3) <- names(Etho4)
Etho <- rbind(Etho1, Etho2, Etho3, Etho4) %>%
  na.omit() %>%
  filter(Mobile!='-')%>%
  as.data.table()
varnms <- names(Etho[,15:26])
Etho[ , (varnms) := lapply(.SD, function(x) gsub(',', '.', x)), .SDcol = varnms ]
Etho[, (varnms) := lapply(.SD, as.numeric), .SDcols= varnms]
Etho <- na.omit(Etho)
Etho[, (varnms) := lapply(.SD, function(x) round(x, digits = 3)), .SDcols= varnms]

```

## Manipulate data

```{r data-manipulation}
## BOLDNESS AND ACTIVITY
#TODO H: Boldness and activity relate.
ggplot(TMEnoNA,aes(activity,boldness))+
  geom_point()+
  geom_smooth(method='gam')
summary(mgcv::gam(TMEnoNA$boldness~s(TMEnoNA$activity, bs = "cs")))
#for each day_test so individuals appear only once at approx same age
day1 = filter(TMEnoNA,day_test==1)
ggplot(day1,aes(activity,boldness))+
  geom_point()+
  geom_smooth(method='gam')
summary(mgcv::gam(day1$boldness~s(day1$activity, bs = "cs")))
day2 = filter(TMEnoNA,day_test==2)
ggplot(day2,aes(activity,boldness))+
  geom_point()+
  geom_smooth(method='gam')
summary(mgcv::gam(day2$boldness~s(day2$activity, bs = "cs")))
day3 = filter(TMEnoNA,day_test==3)
  geom_point()+
ggplot(day3,aes(activity,boldness))+
  geom_smooth(method='gam')
summary(mgcv::gam(day3$boldness~s(day3$activity, bs = "cs")))
#correlation test
cor.test(TMEnoNA$activity, TMEnoNA$boldness, method="pearson")

#TODO H: An individual shows similar activity and boldness scores over various observations.
#         This indicates personality if other factors like age etc play no significant role.
#         DONT KNOW ANY OTHER STATISTICAL TEST FOR PERSONALITY

#TODO H: Families share similar boldness and activity scores.
ggboxplot(TMEnoNA$boldness) + ylab('boldness-score') + xlab('')
ggplot(data=TMEnoNA, aes(x=day_test, y=boldness))+
  geom_point(aes(color=family)) +
  geom_line(aes(group=id,color=family))

## SITE SELECTION
#TODO H: Activity in Personality test is different to activity in Site-Selection test
#         This indicates that the application of Cue in the Testarena affects the spiders behaviour.

#TODO H: The time spend on side with cue is dependent on the age of a spider (cricket boldness ontogeny NiemelÃ¤ 2011).
#         Compare to boldness as function of age. 
#         Data must be filtered for spiders that showed some activity / willingly chose a side
#         when spiders have personality other factors like age should not play a significant role in behaviour control
TMEmoved = TMEnoNA %>%
  filter(t_on_C != 0) %>%
  filter(t_on_C != 600)
TMEmoved2 = TMEnoNA %>%
  filter(activity != 0)
TMEmoved3 = TMEmoved %>%
  filter(activity != 0)
ggplot(data=TMEnoNA, aes(x=day_test, y=t_on_C))+
  geom_jitter(colour='grey70',position=position_jitter(0.03))+
  geom_line(aes(group=id),colour='grey70')+
  geom_boxplot(outlier.colour='black', outlier.shape=16, alpha=0.5) +
  stat_compare_means(comparisons=list(c(1,2),c(2,3),c(1,3)),method='t.test', label='p.signif') +
  theme_bw()
ggplot(data=TMEmoved, aes(x=day_test, y=t_on_C))+
  geom_point(colour='grey70')+
  geom_line(aes(group=id),colour='grey70')+
  geom_boxplot(outlier.colour='black', outlier.shape=16, alpha=0.5) +
  stat_compare_means(comparisons=list(c(1,2),c(2,3),c(1,3)),method='t.test', label='p.signif') +
  theme_bw()
ggplot(data=TMEmoved2, aes(x=day_test, y=t_on_C))+
  geom_point(colour='grey70')+
  geom_line(aes(group=id),colour='grey70')+
  geom_boxplot(outlier.colour='black', outlier.shape=16, alpha=0.5) +
  stat_compare_means(comparisons=list(c(1,2),c(2,3),c(1,3)),method='t.test', label='p.signif') +
  theme_bw()
ggplot(data=TMEmoved3, aes(x=day_test, y=t_on_C))+
  geom_point(colour='grey70')+
  geom_line(aes(group=id),colour='grey70')+
  geom_boxplot(outlier.colour='black', outlier.shape=16, alpha=0.5) +
  stat_compare_means(comparisons=list(c(1,2),c(2,3),c(1,3)),method='t.test', label='p.signif') +
  theme_bw()

ggplot(data=TMEnoNA, aes(x=activity, y=t_on_start_side, group=id,color=id))+
  geom_jitter(position=position_jitter(0.03))+
  geom_line()+
  theme_bw()

# TODO H: activity and or boldness correlate to the time spent on the cue side, and or to the movement parameters.

```